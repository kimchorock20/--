<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>셔틀버스 거리 / 정거장 계산 데모</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 600px;
      margin: 30px auto;
      padding: 0 16px;
      line-height: 1.5;
    }
    h1 {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: 600;
    }
    input {
      width: 100%;
      padding: 6px 8px;
      margin-top: 4px;
      box-sizing: border-box;
    }
    button {
      margin-top: 10px;
      padding: 8px 12px;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }
    button.main {
      background: #2563eb;
      color: white;
    }
    button.sub {
      background: #e5e7eb;
      margin-right: 6px;
    }
    #output {
      margin-top: 20px;
      padding: 12px;
      border-radius: 4px;
      background: #f3f4f6;
      min-height: 40px;
      white-space: pre-line;
    }
    small {
      color: #6b7280;
    }
  </style>
</head>
<body>
  <h1>셔틀버스 거리 / 정거장 계산 데모</h1>
  <p><small>두 기기의 위치(휴대폰, 아이패드)를 넣어서 거리와 남은 정거장을 계산하는 예제입니다.</small></p>

  <!-- A: 예를 들어 "셔틀버스(아이패드)" 위치 -->
  <label>기기 A 위도 (예: 아이패드 / 셔틀버스)</label>
  <input id="latA" type="number" placeholder="위도 (예: 37.123456)" step="0.000001" />
  <label>기기 A 경도</label>
  <input id="lonA" type="number" placeholder="경도 (예: 126.123456)" step="0.000001" />
  <button class="sub" type="button" onclick="setMyLocation('A')">현재 내 위치를 A로 설정</button>

  <!-- B: 예를 들어 "승객(휴대폰)" 위치 -->
  <label style="margin-top: 16px;">기기 B 위도 (예: 휴대폰 / 정류장)</label>
  <input id="latB" type="number" placeholder="위도 (예: 37.654321)" step="0.000001" />
  <label>기기 B 경도</label>
  <input id="lonB" type="number" placeholder="경도 (예: 126.654321)" step="0.000001" />
  <button class="sub" type="button" onclick="setMyLocation('B')">현재 내 위치를 B로 설정</button>

  <!-- 거리 기준 (한 정거장 거리, 평균 속도) -->
  <label style="margin-top: 16px;">한 정거장 거리 (미터)</label>
  <input id="distancePerStop" type="number" value="300" />
  <small>예: 300m면 0.9km 떨어져 있으면 약 3정거장으로 계산</small>

  <label style="margin-top: 16px;">셔틀 예상 속도 (km/h)</label>
  <input id="speedKmh" type="number" value="20" />
  <small>예: 20km/h면 1km 이동에 약 3분 걸림</small>

  <button class="main" type="button" onclick="calculate()">계산하기</button>

  <div id="output"></div>

  <script>
    // 위도/경도 → 거리(m) 계산 (Haversine 공식)
    function getDistanceMeters(lat1, lon1, lat2, lon2) {
      const R = 6371000; // 지구 반지름 (m)
      const toRad = deg => (deg * Math.PI) / 180;

      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);

      const a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(toRad(lat1)) *
          Math.cos(toRad(lat2)) *
          Math.sin(dLon / 2) *
          Math.sin(dLon / 2);

      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c; // meters
    }

    // 브라우저의 현재 위치를 A/B에 넣기
    function setMyLocation(target) {
      if (!navigator.geolocation) {
        alert("이 브라우저에서는 위치 정보를 지원하지 않습니다.");
        return;
      }

      navigator.geolocation.getCurrentPosition(
        pos => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;

          if (target === "A") {
            document.getElementById("latA").value = lat.toFixed(6);
            document.getElementById("lonA").value = lon.toFixed(6);
          } else {
            document.getElementById("latB").value = lat.toFixed(6);
            document.getElementById("lonB").value = lon.toFixed(6);
          }
        },
        err => {
          console.error(err);
          alert("위치 정보를 가져오지 못했습니다: " + err.message);
        }
      );
    }

    function calculate() {
      const latA = parseFloat(document.getElementById("latA").value);
      const lonA = parseFloat(document.getElementById("lonA").value);
      const latB = parseFloat(document.getElementById("latB").value);
      const lonB = parseFloat(document.getElementById("lonB").value);
      const distancePerStop = parseFloat(
        document.getElementById("distancePerStop").value
      );
      const speedKmh = parseFloat(document.getElementById("speedKmh").value);

      const output = document.getElementById("output");

      if (
        isNaN(latA) ||
        isNaN(lonA) ||
        isNaN(latB) ||
        isNaN(lonB) ||
        isNaN(distancePerStop) ||
        isNaN(speedKmh)
      ) {
        output.textContent = "모든 값을 정확히 입력해 주세요.";
        return;
      }

      // 거리(m) 계산
      const distance = getDistanceMeters(latA, lonA, latB, lonB);

      // 남은 정거장 수
      const stopsLeft = Math.max(
        0,
        Math.round(distance / distancePerStop)
      );

      // 예상 도착 시간 (분)
      const distanceKm = distance / 1000;
      const timeHours = distanceKm / speedKmh; // 시간
      const timeMinutes = timeHours * 60;

      output.textContent =
        `두 기기 사이 거리: ${distance.toFixed(1)} m\n` +
        `남은 정거장 수(대략): ${stopsLeft} 정거장\n` +
        `예상 도착 시간(대략): ${timeMinutes.toFixed(1)} 분`;
    }
  </script>
</body>
</html>
